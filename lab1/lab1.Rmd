---
title: "Developing a prediction model for car mileage"
subtitle: "Report for Lab 1 in Linear Statistical Models (MVE190)"
author: "Joel Goop"
date: "November 9, 2016"
output: 
  bookdown::pdf_document2:
    number_sections: true
    includes:
      in_header: header.tex
documentclass: article
classoption: a4
geometry: margin=3cm
toc: false
---

```{r setup, include=FALSE}
library(ggplot2)
knitr::opts_chunk$set(echo = TRUE)

load('Lab1data.RData')
load('itest.RData')
Auto.Train<-newAuto[-itest,]
Auto.Test<-newAuto[itest,]

source('~/git/mve190/lab1/funcs.R')
```

# Introduction

The objective of this lab is to model the relationship between the selling price and the floor area of houses based on the `house` dataset. To ascertain the validity of the model, we also investigate the data to ensure that the 5 basic assumptions of 

Table \@ref(tab:datasummary)

```{r datasummary,echo=FALSE}
summarydf<-sapply(Auto.Train,tabled.summary)
knitr::kable(t(summarydf)$Missing,
             caption='Summary statistics for the sampled part of the `Auto` dataset',
             digits=0,
             booktabs=TRUE)
```

# Methods

The primary method used is ordinary least squares fitting of a linear regression model to predict the mileage of a car based on 6 other properties. A dataset with 376 datapoints   Missing values are imputed using regression models based on related variables in the dataset. 

The analysis is implemented in `R` using mainly the standard library, but the `leaps` package is used to simplify model selection.

# Results and discussion


## Imputation


## Variable transformations

```{r initialdatatransform, echo=FALSE}
trauto <- Auto.Train[complete.cases(Auto.Train),]
# Transform 1/y
trauto$mpg <- 1/trauto$mpg
# Rename to gpm
names(trauto)[names(trauto)=="mpg"] <- "gpm"
```

Pairwise scatter plots of the data revealed several strong connections between the variables and the mileage, but also internally between variables. Based on the shape of the relation between mileage and several other variables an inverse transform was applied, converting mileage (miles per gallon) to fuel consumption (gallons per mile). In  Figure \@ref(fig:initialscatter), the mileage and fuel consumption is plotted against weight. After the transformation the relationship seems sufficiently linear to apply regression.

```{r initialscatter,echo=FALSE,fig.cap='Mileage against weight (left) and inverse mileage (or fuel consumption) against weight (right). After the inverse transformation the relationship seems more or less linear.',fig.height=3.5,fig.width=7}

p1<-(ggplot(trauto, aes(x=weight, y=1/gpm))
      +geom_point(shape=21,fill='white')
      +labs(x="Weight",y="Miles per gallon"))
p2<-(ggplot(trauto, aes(x=weight, y=gpm))
      +geom_point(shape=21,fill='white')
      +labs(x="Weight",y="Gallons per mile"))

multiplot(p1,p2,cols=2)
```

## Model selection 


# Conclusion
